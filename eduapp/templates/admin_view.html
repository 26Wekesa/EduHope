{% extends 'starter-page.html'%}

{% load static %}

{% block title %} Admin Dashboard {% endblock %}

{% block content %}

<!-- Admin Dashboard Section -->
<section class="admin-dashboard section">
  <div class="container">
    
    <!-- Dashboard Header -->
    <div class="dashboard-header mb-5">
      <h1>EduHope Admin Dashboard</h1>
      <p>Manage learners, mentors, partners, and messages</p>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-5 justify-content-center">
      <div class="col-6 col-md-4 col-lg-2 mb-4">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-people-fill"></i>
          </div>
          <div class="stat-content">
            <h5>Approved Learners</h5>
            <p class="stat-number">{{ approved_learners }}</p>
            
          </div>
        </div>
      </div>

      <div class="col-6 col-md-4 col-lg-2 mb-4">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-person-badge"></i>
          </div>
          <div class="stat-content">
            <h5>Approved Mentors</h5>
            <p class="stat-number">{{ approved_mentors }}</p>
            
          </div>
        </div>
      </div>

      <div class="col-6 col-md-4 col-lg-2 mb-4">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-building"></i>
          </div>
          <div class="stat-content">
            <h5>Approved Partners</h5>
            <p class="stat-number">{{ approved_partners }}</p>
            
          </div>
        </div>
      </div>

      <div class="col-6 col-md-4 col-lg-2 mb-4">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-envelope-open"></i>
          </div>
          <div class="stat-content">
            <h5>Total Messages</h5>
            <p class="stat-number">{{ total_messages }}</p>

          </div>
        </div>
      </div>

      <div class="col-6 col-md-4 col-lg-2 mb-4">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-calendar-check"></i>
          </div>
          <div class="stat-content">
            <h5>Bookings</h5>
            <p class="stat-number">{{ total_bookings }}</p>
            
          </div>
        </div>
      </div>

      <div class="col-6 col-md-4 col-lg-2 mb-4">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-cash"></i>
          </div>
          <div class="stat-content">
            <h5>Total Donations</h5>
            <p class="stat-number">{{ total_donations }}</p>
            
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs for Different Sections -->
    <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="messages-tab" data-bs-toggle="tab" data-bs-target="#messages" type="button" role="tab">Messages</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="learners-tab" data-bs-toggle="tab" data-bs-target="#learners" type="button" role="tab">Learners</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="mentors-tab" data-bs-toggle="tab" data-bs-target="#mentors" type="button" role="tab">Mentors</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="partners-tab" data-bs-toggle="tab" data-bs-target="#partners" type="button" role="tab">Partners</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="bookings-tab" data-bs-toggle="tab" data-bs-target="#bookings" type="button" role="tab">Bookings</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="donations-tab" data-bs-toggle="tab" data-bs-target="#donations" type="button" role="tab">Donations</button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="adminTabContent">
      
      <!-- Messages Tab -->
      <div class="tab-pane fade show active" id="messages" role="tabpanel">
        <div class="data-section">
          <h3>Latest Messages</h3>
          {% if all_messages %}
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-dark">
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Subject</th>
                    <th>Message</th>
                    <th>Action</th>
                    
                  </tr>
                </thead>
                <tbody>
                  {% for msg in all_messages %}
                  <tr>
                    <td><strong>{{ msg.name }}</strong></td>
                    <td><a href="mailto:{{ msg.email }}">{{ msg.email }}</a></td>
                    <td>{{ msg.subject }}</td>
                    <td>
                      <small>{{ msg.message|truncatewords:10 }}</small>
                    </td>
                    <td>
                      <a href="/delete/{{msg.id}}" class="btn btn-danger">Delete</a>
           
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">No messages yet.</div>
          {% endif %}
        </div>
      </div>

      <!-- Learners Tab -->
      <div class="tab-pane fade" id="learners" role="tabpanel">
  <div class="data-section">
    <h3>Support Applications</h3>

    {% if applications %}
      <div class="table-responsive">
        <table class="table table-hover table-striped">
          <thead class="table-dark">
            <tr>
              <th>Learner</th>
              <th>DOB</th>
              <th>Grade</th>
              <th>School</th>
              <th>Support Type</th>
              <th>Situation</th>
              <th>Guardian</th>
              <th>Contact</th>
              <th>Informant</th>
              <th>Status</th>
              <th>Actions</th>
            
            </tr>
          </thead>
          <tbody>
            {% for app in applications %}
            <tr>
              <td><strong>{{ app.learner_name }}</strong></td>
              <td>{{ app.dob }}</td>
              <td>{{ app.grade }}</td>
              <td>{{ app.school }}</td>

              <td>{{ app.support_type }}</td>

              <td>
                <small>{{ app.situation_description|truncatewords:15 }}</small>
              </td>

              <td>{{ app.guardian_name }} ({{ app.relationship }})</td>
              <td>{{ app.guardian_contact }}</td>

              <td>
                {{ app.informant_name }}  
                <br>
                <small>{{ app.informant_phone }}</small>
              </td>
              <td>
                {% if app.approved %}
                  <span class="badge bg-success">Approved</span>
                {% else %}
                  <span class="badge bg-warning">Pending</span>
                {% endif %}
              </td>
              <td>
                {% if not app.approved %}
                  <a href="{% url 'approve_learner' app.id %}" class="btn btn-success btn-sm">Approve</a>
                {% endif %}
                <a href="{% url 'delete_learner' app.id %}" class="btn btn-danger btn-sm">Delete</a>
              </td>
              
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    {% else %}
      <div class="alert alert-info">No support applications submitted yet.</div>
    {% endif %}
  </div>
</div>

      <!-- Mentors Tab -->
      <div class="tab-pane fade" id="mentors" role="tabpanel">
        <div class="data-section">
          <h3>Registered Mentors</h3>
          {% if mentors %}
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-dark">
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>phone</th>
                    <th>Organization</th>
                    <th>years</th>
                    <th>bio</th>
                    <th>subject</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for mentor in mentors %}
                  <tr>
                    <td><strong>{{ mentor.name }}</strong></td>
                    <td><a href="mailto:{{ mentor.email }}">{{ mentor.email }}</a></td>
                    <td>{{ mentor.phone }}</td>
                    <td>{{ mentor.organization }}</td>
                    <td>{{ mentor.years }} years</td>
                    <td>{{ mentor.bio }}</td>
                    <td>{{ mentor.subject }}</td>
                    <td>
                      {% if mentor.approved %}
                        <span class="badge bg-success">Approved</span>
                      {% else %}
                        <span class="badge bg-warning">Pending</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if not mentor.approved %}
                        <a href="{% url 'approve_mentor' mentor.id %}" class="btn btn-success btn-sm">Approve</a>
                      {% endif %}
                      <a href="{% url 'delete_mentor' mentor.id %}" class="btn btn-danger btn-sm">Delete</a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">No mentors registered yet.</div>
          {% endif %}
        </div>
      </div>

      <!-- Partners Tab -->
      <div class="tab-pane fade" id="partners" role="tabpanel">
        <div class="data-section">
          <h3>Partnership Requests</h3>
          {% if all_partners %}
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-dark">
                  <tr>
                    <th>Organization</th>
                    <th>Type</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Area</th>
                    <th>Status</th>
                    <th>Submitted</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for partner in all_partners %}
                  <tr>
                    <td><strong>{{ partner.org_name }}</strong></td>
                    <td>{{ partner.partner_type }}</td>
                    <td><a href="mailto:{{ partner.email }}">{{ partner.email }}</a></td>
                    <td>{{ partner.phone }}</td>
                    <td>{{ partner.partnership_area }}</td>
                    <td>
                      {% if partner.approved %}
                        <span class="badge bg-success">Approved</span>
                      {% else %}
                        <span class="badge bg-warning">Pending</span>
                      {% endif %}
                    </td>
                    <td><small>{{ partner.submitted_at|date:"M d, Y" }}</small></td>
                    <td>
                      {% if not partner.approved %}
                        <a href="{% url 'approve_partner' partner.id %}" class="btn btn-success btn-sm">Approve</a>
                      {% endif %}
                      <a href="{% url 'delete_partner' partner.id %}" class="btn btn-danger btn-sm">Delete</a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">No partnership requests yet.</div>
          {% endif %}
        </div>
      </div>

      <!-- Mentorship Bookings Tab -->
      <div class="tab-pane fade" id="bookings" role="tabpanel">
        <div class="data-section">
          <h3>Bookings</h3>
          {% if bookings %}
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-dark">
                  <tr>
                    <th>School</th>
                    <th>Contact Person</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Learners</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Duration</th>
                  </tr>
                </thead>
                <tbody>
                  {% for booking in bookings %}
                  <tr>
                    <td><strong>{{ booking.school_name }}</strong></td>
                    <td>{{ booking.contact_person }}</td>
                    <td><a href="mailto:{{ booking.email }}">{{ booking.email }}</a></td>
                    <td>{{ booking.phone }}</td>
                    <td>{{ booking.number_of_learners }}</td>
                    <td>{{ booking.preferred_date }}</td>
                    <td>{{ booking.preferred_time }}</td>
                    <td>{{ booking.duration_hours }} hours</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">No bookings yet.</div>
          {% endif %}
        </div>
      </div>

      <!-- Donations Tab -->
      <div class="tab-pane fade" id="donations" role="tabpanel">
        <div class="data-section">
          <h3>Donations</h3>
          {% if donations %}
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-dark">
                  <tr>
                    <th>Donor</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Amount</th>
                    <th>Type</th>
                    <th>Submitted</th>
                  </tr>
                </thead>
                <tbody>
                  {% for donation in donations %}
                  <tr>
                    <td><strong>{{ donation.donor_name }}</strong></td>
                    <td><a href="mailto:{{ donation.email }}">{{ donation.email }}</a></td>
                    <td>{{ donation.phone }}</td>
                    <td>${{ donation.amount }}</td>
                    <td>{{ donation.get_donation_type_display }}</td>
                    <td><small>{{ donation.submitted_at|date:"M d, Y" }}</small></td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">No donations yet.</div>
          {% endif %}
        </div>
      </div>

    </div>

  </div>
</section><!-- /Admin Dashboard Section -->

<style>
  .admin-dashboard {
    padding: 40px 0;
    background-color: #f8f9fa;
  }

  .dashboard-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .dashboard-header h1 {
    color: #333;
    font-weight: 700;
    margin-bottom: 10px;
  }

  .stat-card {
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: 20px;
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .stat-icon {
    font-size: 32px;
    color: #0d6efd;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e7f1ff;
    border-radius: 8px;
  }

  .stat-content h5 {
    margin: 0;
    font-size: 14px;
    color: #666;
    font-weight: 500;
  }

  .stat-number {
    margin: 5px 0;
    font-size: 28px;
    font-weight: 700;
    color: #333;
  }

  .nav-tabs {
    border-bottom: 2px solid #dee2e6;
  }

  .nav-tabs .nav-link {
    color: #666;
    border: none;
    border-bottom: 3px solid transparent;
    padding: 12px 20px;
    margin-bottom: -2px;
    transition: all 0.3s;
  }

  .nav-tabs .nav-link:hover {
    color: #0d6efd;
    border-bottom-color: #0d6efd;
  }

  .nav-tabs .nav-link.active {
    color: #0d6efd;
    background-color: transparent;
    border-bottom-color: #0d6efd;
  }

  .data-section {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .data-section h3 {
    color: #333;
    font-weight: 600;
    margin-bottom: 20px;
  }

  .table {
    margin-bottom: 0;
  }

  .table thead th {
    font-weight: 600;
    border: none;
    padding: 15px;
  }

  .table tbody td {
    padding: 15px;
    vertical-align: middle;
    border-bottom: 1px solid #dee2e6;
  }

  .table tbody tr:hover {
    background-color: #f8f9fa;
  }

  .badge {
    padding: 6px 12px;
    font-weight: 500;
  }

  .alert {
    padding: 20px;
    border-radius: 8px;
    border: none;
  }
</style>

{% endblock %}